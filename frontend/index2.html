<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Molding Process Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 10px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden; }
        .header { background: linear-gradient(45deg, #2c3e50, #34495e); color: white; padding: 20px; text-align: center; position: relative; }
        .header h1 { font-size: 1.8rem; margin-bottom: 10px; }
        .sync-status { position: absolute; top: 15px; right: 15px; padding: 5px 10px; border-radius: 15px; font-size: 0.8rem; font-weight: bold; }
        .sync-online { background: #27ae60; color: white; }
        .sync-offline { background: #e74c3c; color: white; }
        .sync-syncing { background: #f39c12; color: white; }
        .nav-tabs { display: flex; background: #ecf0f1; overflow-x: auto; }
        .nav-tab { padding: 15px 20px; background: none; border: none; cursor: pointer; white-space: nowrap; transition: all 0.3s; font-size: 0.9rem; font-weight: 500; }
        .nav-tab.active, .nav-tab:hover { background: #3498db; color: white; }
        .tab-content { display: none; padding: 30px; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #2c3e50; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; transition: border-color 0.3s; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #3498db; }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: 600; transition: all 0.3s; margin: 5px; position: relative; }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .btn-primary { background: #3498db; color: white; }
        .btn-primary:hover:not(:disabled) { background: #2980b9; transform: translateY(-2px); }
        .btn-success { background: #27ae60; color: white; }
        .btn-success:hover:not(:disabled) { background: #229954; }
        .btn-danger { background: #e74c3c; color: white; }
        .btn-danger:hover:not(:disabled) { background: #c0392b; }
        .loading { display: none; }
        .loading.show { display: inline-block; width: 16px; height: 16px; border: 2px solid transparent; border-top: 2px solid white; border-radius: 50%; animation: spin 1s linear infinite; margin-left: 8px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .alert { padding: 15px; margin: 15px 0; border-radius: 8px; font-weight: 500; }
        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .alert-danger { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .alert-info { background: #d1ecf1; color: #0c5460; border: 1px solid #b8daff; }
        .data-table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .data-table th, .data-table td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        .data-table th { background: #34495e; color: white; font-weight: 600; }
        .data-table tr:nth-child(even) { background: #f8f9fa; }
        .status-ok { color: #27ae60; font-weight: bold; }
        .status-ng { color: #e74c3c; font-weight: bold; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .card { background: #f8f9fa; padding: 20px; border-radius: 10px; border-left: 4px solid #3498db; }
        .file-input { margin-top: 10px; }
        .sync-info { background: #e8f4fd; border: 1px solid #bee5eb; border-radius: 8px; padding: 15px; margin-bottom: 20px; }
        .sync-info h4 { color: #0c5460; margin-bottom: 8px; }
        .sync-info p { color: #0c5460; margin: 0; font-size: 0.9rem; }
        @media (max-width: 768px) { .container { margin: 0; border-radius: 0; } .nav-tabs { flex-wrap: wrap; } .nav-tab { flex: 1; min-width: 120px; } .tab-content { padding: 20px; } .grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="sync-status" id="syncStatus">
                <span id="syncStatusText">æ¥ç¶šä¸­...</span>
            </div>
            <h1>Molding Process Dashboard</h1>
            <p>PROCESS 1ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åŒæœŸå¯¾å¿œï¼‰</p>
        </div>
        
        <div class="sync-info" id="syncInfo">
            <h4>ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åŒæœŸæ©Ÿèƒ½</h4>
            <p>ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã¯ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«åŒæœŸã•ã‚Œã¾ã™ã€‚æœ€çµ‚åŒæœŸ: <span id="lastSync">æœªåŒæœŸ</span></p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('resin')">æ¨¹è„‚ä¾›çµ¦ç›£è¦–</button>
            <button class="nav-tab" onclick="showTab('temperature')">æ¸©åº¦ãƒ»åŸºæº–ç®¡ç†</button>
            <button class="nav-tab" onclick="showTab('preform')">ãƒ—ãƒªãƒ•ã‚©ãƒ¼ãƒ å“è³ª</button>
            <button class="nav-tab" onclick="showTab('molding')">æˆå‹å·¥ç¨‹ãƒ¢ãƒ‹ã‚¿</button>
            <button class="nav-tab" onclick="showTab('cooling')">å†·å´æ™‚é–“ãƒ­ã‚°</button>
            <button class="nav-tab" onclick="showTab('inspection')">æ¤œæŸ»å·¥ç¨‹</button>
            <button class="nav-tab" onclick="showTab('traceability')">ãƒˆãƒ¬ãƒ¼ã‚µãƒ“ãƒªãƒ†ã‚£</button>
        </div>

        <!-- æ¨¹è„‚ä¾›çµ¦ç›£è¦– -->
        <div id="resin" class="tab-content active">
            <h2>ğŸ›¢ï¸ æ¨¹è„‚ä¾›çµ¦ç›£è¦–</h2>
            <div class="grid">
                <div class="card">
                    <h3>ã‚¿ãƒ³ã‚¯æ®‹é‡ãƒã‚§ãƒƒã‚¯</h3>
                    <div class="form-group">
                        <label>ã‚¿ãƒ³ã‚¯ç•ªå·</label>
                        <select id="tankNumber">
                            <option value="TANK-001">TANK-001</option>
                            <option value="TANK-002">TANK-002</option>
                            <option value="TANK-003">TANK-003</option>
                        </select>
                    </div>
                                
                    <div class="form-group">
                        <label>æ®‹é‡çŠ¶æ³</label>
                        <select id="resinStatus">
                            <option value="OK">OK - ååˆ†</option>
                            <option value="NG">NG - è¦è£œå……</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ç¢ºèªè€…</label>
                        <input type="text" id="resinChecker" placeholder="ç¢ºèªè€…åã‚’å…¥åŠ›">
                    </div>
                    <button class="btn btn-primary" onclick="recordResinCheck()" id="resinCheckBtn">
                        æ®‹é‡ãƒã‚§ãƒƒã‚¯è¨˜éŒ²
                        <span class="loading" id="resinCheckLoading"></span>
                    </button>
                </div>
                <div class="card">
                    <h3>æ¨¹è„‚è£œå……è¨˜éŒ²</h3>
                    <div class="form-group">
                        <label>è£œå……é‡ (kg)</label>
                        <input type="number" id="resinAmount" placeholder="è£œå……é‡ã‚’å…¥åŠ›">
                    </div>
                    <div class="form-group">
                        <label>è£œå……è€…</label>
                        <input type="text" id="resinSupplier" placeholder="è£œå……è€…åã‚’å…¥åŠ›">
                    </div>

                     <div class="form-group" >
                            <label>å‚™è€ƒ</label>
                            <input type="text" id="resinNotes" placeholder="ä¾‹: è£œå……ã‚¿ã‚¤ãƒŸãƒ³ã‚°é…å»¶ã‚ã‚Š">
                    </div>

                    <button class="btn btn-success" onclick="recordResinSupply()" id="resinSupplyBtn">
                        è£œå……å®Œäº†è¨˜éŒ²
                        <span class="loading" id="resinSupplyLoading"></span>
                    </button>
                </div>
            </div>
            <div id="resinAlert"></div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>æ—¥æ™‚</th>
                        <th>ã‚¿ãƒ³ã‚¯</th>
                        <th>çŠ¶æ³</th>
                        <th>ä½œæ¥­è€…</th>
                        <th>è£œå……é‡</th>
                        <th>è£œå……è€…</th> 
                        <th>å‚™è€ƒ</th>   
                        <th>åŒæœŸçŠ¶æ…‹</th>
                    </tr>
                </thead>
                <tbody id="resinTable"></tbody>
            </table>
        </div>

        <!-- æ¸©åº¦ãƒ»åŸºæº–ç®¡ç† -->
        <div id="temperature" class="tab-content">
            <h2>ğŸŒ¡ï¸ æ¸©åº¦ãƒ»åŸºæº–ç®¡ç†</h2>
            <div class="grid">
                <div class="card">
                    <h3>æ¸©åº¦è¨˜éŒ²</h3>
                    <div class="form-group">
                        <label for="lotNumber">ãƒ­ãƒƒãƒˆç•ªå·</label>
                        <select id="lotNumber">
                            <option value="">ãƒ­ãƒƒãƒˆã‚’é¸æŠ</option>
                            <option value="250614-GT01">250614-GT01ï¼ˆç·‘èŒ¶ï¼‰</option>
                            <option value="250614-HT01">250614-HT01ï¼ˆã»ã†ã˜èŒ¶ï¼‰</option>
                            <option value="250614-BT01">250614-BT01ï¼ˆç´…èŒ¶ï¼‰</option>
                            <option value="250614-XX01">250614-XX01ï¼ˆãã®ä»–ï¼‰</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="setTemp">è¨­å®šæ¸©åº¦ (Â°C)</label>
                        <input type="number" id="setTemp" value="280" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>å®Ÿæ¸¬æ¸©åº¦ (Â°C)</label>
                        <input type="number" id="actualTemp" step="0.1" placeholder="å®Ÿæ¸¬å€¤ã‚’å…¥åŠ›">
                    </div>
                    <div class="form-group">
                        <label>æ¸¬å®šè€…</label>
                        <input type="text" id="tempChecker" placeholder="æ¸¬å®šè€…åã‚’å…¥åŠ›">
                    </div>
                    <button class="btn btn-primary" onclick="recordTemperature()" id="tempRecordBtn">
                        æ¸©åº¦è¨˜éŒ²
                        <span class="loading" id="tempRecordLoading"></span>
                    </button>
                </div>
            </div>
            <div id="tempAlert"></div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>æ—¥æ™‚</th>
                        <th>ãƒ­ãƒƒãƒˆ</th>
                        <th>è¨­å®šæ¸©åº¦</th>
                        <th>å®Ÿæ¸¬æ¸©åº¦</th>
                        <th>å·®ç•°</th>
                        <th>åˆ¤å®š</th>
                        <th>æ¸¬å®šè€…</th>
                        <th>åŒæœŸçŠ¶æ…‹</th>
                    </tr>
                </thead>
                <tbody id="tempTable"></tbody>
            </table>
        </div>

        <!-- ãƒ—ãƒªãƒ•ã‚©ãƒ¼ãƒ å“è³ªç¢ºèª -->
        <div id="preform" class="tab-content">
            <h2>ğŸ§ª ãƒ—ãƒªãƒ•ã‚©ãƒ¼ãƒ å“è³ªç¢ºèª</h2>
            <div class="grid">
                <div class="card">
                    <h3>å“è³ªãƒã‚§ãƒƒã‚¯</h3>
                    <div class="form-group">
                        <label>ã‚µãƒ³ãƒ—ãƒ«ç•ªå·</label>
                        <input type="text" id="sampleNumber" placeholder="SAMPLE-001">
                    </div>
                    <div class="form-group">
                        <label>é‡é‡ (g)</label>
                        <input type="number" id="preformWeight" step="0.1" placeholder="åŸºæº–: 23.5Â±0.5g">
                    </div>
                    <div class="form-group">
                        <label>å½¢çŠ¶è©•ä¾¡</label>
                        <select id="shapeEval">
                            <option value="è‰¯å¥½">è‰¯å¥½</option>
                            <option value="è»½å¾®ãªå¤‰å½¢">è»½å¾®ãªå¤‰å½¢</option>
                            <option value="è¦å†åŠ å·¥">è¦å†åŠ å·¥</option>
                            <option value="å»ƒæ£„">å»ƒæ£„</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>æ¤œæŸ»è€…</label>
                        <input type="text" id="preformInspector" placeholder="æ¤œæŸ»è€…åã‚’å…¥åŠ›">
                    </div>
                    <div class="form-group">
                        <label>å†™çœŸæ·»ä»˜</label>
                        <input type="file" id="preformPhoto" accept="image/*" class="file-input">
                    </div>
                    <button class="btn btn-primary" onclick="recordPreformCheck()" id="preformCheckBtn">
                        å“è³ªãƒã‚§ãƒƒã‚¯è¨˜éŒ²
                        <span class="loading" id="preformCheckLoading"></span>
                    </button>
                </div>
            </div>
            <div id="preformAlert"></div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>æ—¥æ™‚</th>
                        <th>ã‚µãƒ³ãƒ—ãƒ«</th>
                        <th>é‡é‡</th>
                        <th>å½¢çŠ¶</th>
                        <th>åˆ¤å®š</th>
                        <th>æ¤œæŸ»è€…</th>
                        <th>å‡¦ç†</th>
                        <th>åŒæœŸçŠ¶æ…‹</th>
                    </tr>
                </thead>
                <tbody id="preformTable"></tbody>
            </table>
        </div>

        <!-- æˆå‹å·¥ç¨‹ãƒ¢ãƒ‹ã‚¿ -->
        <div id="molding" class="tab-content">
            <h2>ğŸ­ æˆå‹å·¥ç¨‹ãƒ¢ãƒ‹ã‚¿</h2>
            <div class="grid">
                <div class="card">
                    <h3>æˆå‹å“è³ªãƒã‚§ãƒƒã‚¯</h3>
                    <div class="form-group">
                        <label>è£½å“ç•ªå·</label>
                        <input type="text" id="productNumber" placeholder="PROD-001">
                    </div>
                    <div class="form-group">
                        <label>åšã¿ (mm)</label>
                        <input type="number" id="thickness" step="0.01" placeholder="åŸºæº–: 0.3Â±0.05mm">
                    </div>
                    <div class="form-group">
                        <label>ãƒœãƒˆãƒ«å½¢çŠ¶</label>
                        <select id="bottleShape">
                            <option value="æ­£å¸¸">æ­£å¸¸</option>
                            <option value="è»½å¾®ãªæ­ªã¿">è»½å¾®ãªæ­ªã¿</option>
                            <option value="è¦èª¿æ•´">è¦èª¿æ•´</option>
                            <option value="å»ƒæ£„">å»ƒæ£„</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>æ¤œæŸ»è€…</label>
                        <input type="text" id="moldingInspector" placeholder="æ¤œæŸ»è€…åã‚’å…¥åŠ›">
                    </div>
                    <button class="btn btn-primary" onclick="recordMoldingCheck()" id="moldingCheckBtn">
                        æˆå‹ãƒã‚§ãƒƒã‚¯è¨˜éŒ²
                        <span class="loading" id="moldingCheckLoading"></span>
                    </button>
                </div>
            </div>
            <div id="moldingAlert"></div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>æ—¥æ™‚</th>
                        <th>è£½å“</th>
                        <th>åšã¿</th>
                        <th>å½¢çŠ¶</th>
                        <th>åˆ¤å®š</th>
                        <th>æ¤œæŸ»è€…</th>
                        <th>å‡¦ç†</th>
                        <th>åŒæœŸçŠ¶æ…‹</th>
                    </tr>
                </thead>
                <tbody id="moldingTable"></tbody>
            </table>
        </div>

        <!-- å†·å´æ™‚é–“ãƒ­ã‚° -->
        <div id="cooling" class="tab-content">
            <h2>â„ï¸ å†·å´æ™‚é–“ãƒ­ã‚°ç®¡ç†</h2>
            <div class="grid">
                <div class="card">
                    <h3>å†·å´æ™‚é–“è¨˜éŒ²</h3>
                    <div class="form-group">
                        <label>ãƒ­ãƒƒãƒˆç•ªå·</label>
                        <input type="text" id="coolingLot" placeholder="LOT-YYYYMMDD-001">
                    </div>
                    <div class="form-group">
                        <label>å†·å´é–‹å§‹æ™‚é–“</label>
                        <input type="datetime-local" id="coolingStart">
                    </div>
                    <div class="form-group">
                        <label>å†·å´çµ‚äº†æ™‚é–“</label>
                        <input type="datetime-local" id="coolingEnd">
                    </div>
                    <div class="form-group">
                        <label>ä½œæ¥­è€…</label>
                        <input type="text" id="coolingOperator" placeholder="ä½œæ¥­è€…åã‚’å…¥åŠ›">
                    </div>
                    <button class="btn btn-primary" onclick="recordCooling()" id="coolingBtn">
                        å†·å´è¨˜éŒ²
                        <span class="loading" id="coolingLoading"></span>
                    </button>
                </div>
            </div>
            <div id="coolingAlert"></div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>æ—¥æ™‚</th>
                        <th>ãƒ­ãƒƒãƒˆ</th>
                        <th>é–‹å§‹æ™‚é–“</th>
                        <th>çµ‚äº†æ™‚é–“</th>
                        <th>å†·å´æ™‚é–“</th>
                        <th>åˆ¤å®š</th>
                        <th>ä½œæ¥­è€…</th>
                        <th>åŒæœŸçŠ¶æ…‹</th>
                    </tr>
                </thead>
                <tbody id="coolingTable"></tbody>
            </table>
        </div>

        <!-- æ¤œæŸ»å·¥ç¨‹ -->
        <div id="inspection" class="tab-content">
            <h2>ğŸ” æ¤œæŸ»å·¥ç¨‹ã®è‡ªå‹•åŒ–æ”¯æ´</h2>
            <div class="grid">
                <div class="card">
                    <h3>æœ€çµ‚æ¤œæŸ»</h3>
                    <div class="form-group">
                        <label>æ¤œæŸ»ID</label>
                        <input type="text" id="inspectionId" placeholder="INS-001">
                    </div>
                    <div class="form-group">
                        <label>å¤–è¦³æ¤œæŸ»</label>
                        <select id="visualCheck">
                            <option value="åˆæ ¼">åˆæ ¼</option>
                            <option value="ä¸åˆæ ¼">ä¸åˆæ ¼</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>å¯¸æ³•æ¤œæŸ»</label>
                        <select id="dimensionCheck">
                            <option value="åˆæ ¼">åˆæ ¼</option>
                            <option value="ä¸åˆæ ¼">ä¸åˆæ ¼</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>è€åœ§æ¤œæŸ»</label>
                        <select id="pressureCheck">
                            <option value="åˆæ ¼">åˆæ ¼</option>
                            <option value="ä¸åˆæ ¼">ä¸åˆæ ¼</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>æ¤œæŸ»è€…</label>
                        <input type="text" id="finalInspector" placeholder="æ¤œæŸ»è€…åã‚’å…¥åŠ›">
                    </div>
                    <button class="btn btn-primary" onclick="recordInspection()" id="inspectionBtn">
                        æ¤œæŸ»è¨˜éŒ²
                        <span class="loading" id="inspectionLoading"></span>
                    </button>
                </div>
            </div>
            <div id="inspectionAlert"></div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>æ—¥æ™‚</th>
                        <th>æ¤œæŸ»ID</th>
                        <th>å¤–è¦³</th>
                        <th>å¯¸æ³•</th>
                        <th>è€åœ§</th>
                        <th>ç·åˆåˆ¤å®š</th>
                        <th>æ¤œæŸ»è€…</th>
                        <th>å‡¦ç†</th>
                    </tr>
                </thead>
                <tbody id="inspectionTable"></tbody>
            </table>
        </div>

        <!-- ãƒˆãƒ¬ãƒ¼ã‚µãƒ“ãƒªãƒ†ã‚£ -->
        <div id="traceability" class="tab-content">
            <h2>ğŸ“Š ãƒˆãƒ¬ãƒ¼ã‚µãƒ“ãƒªãƒ†ã‚£æ©Ÿèƒ½</h2>
            <div class="grid">
                <div class="card">
                    <h3>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¤œç´¢</h3>
                    <div class="form-group">
                        <label>ãƒ­ãƒƒãƒˆç•ªå·ã§æ¤œç´¢</label>
                        <input type="text" id="searchLot" placeholder="LOT-YYYYMMDD-001">
                    </div>
                    <button class="btn btn-primary" onclick="searchLot()" id="searchBtn">
                        ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¤œç´¢
                        <span class="loading" id="searchLoading"></span>
                    </button>
                    <button class="btn btn-success" onclick="exportData()">ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                </div>
            </div>
            <div id="traceabilityResult"></div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>å·¥ç¨‹</th>
                        <th>æ—¥æ™‚</th>
                        <th>è©³ç´°</th>
                        <th>ä½œæ¥­è€…</th>
                        <th>çµæœ</th>
                        <th>ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹</th>
                    </tr>
                </thead>
                <tbody id="traceabilityTable"></tbody>
            </table>
        </div>
    </div>

    <script>
        // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åŒæœŸæ©Ÿèƒ½ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
        class DatabaseSyncManager {
            constructor() {
                this.isOnline = false;
                this.syncQueue = [];
                this.lastSyncTime = null;
                this.syncInProgress = false;
                this.initializeConnection();
            }

            async initializeConnection() {
                try {
                    await this.simulateConnectionCheck();
                    this.isOnline = true;
                    this.updateSyncStatus('online', 'ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šæ¸ˆã¿');
                    await this.loadInitialData();
                } catch (error) {
                    this.isOnline = false;
                    this.updateSyncStatus('offline', 'æ¥ç¶šã‚¨ãƒ©ãƒ¼');
                    console.error('Database connection failed:', error);
                }
            }

            async simulateConnectionCheck() {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        if (Math.random() > 0.1) {
                            resolve();
                        } else {
                            reject(new Error('Connection timeout'));
                        }
                    }, 1000);
                });
            }

            updateSyncStatus(status, message) {
                const statusElement = document.getElementById('syncStatus');
                const statusText = document.getElementById('syncStatusText');
                
                statusElement.className = `sync-status sync-${status}`;
                statusText.textContent = message;

                if (this.lastSyncTime) {
                    document.getElementById('lastSync').textContent = this.lastSyncTime.toLocaleString('ja-JP');
                }
            }

            async syncData(tableName, data) {
                if (!this.isOnline) {
                    this.syncQueue.push({ tableName, data, timestamp: new Date() });
                    return { success: false, queued: true };
                }

                try {
                    this.updateSyncStatus('syncing', 'åŒæœŸä¸­...');
                    
                    // å®Ÿéš›ã®APIæ¥ç¶š
                    const response = await fetch(`http://localhost:3000/api/${tableName.replace('_', '-')}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });
                    
                    if (!response.ok) {
                         const errorText = await response.text();
                         console.error('âŒ APIãƒ¬ã‚¹ãƒãƒ³ã‚¹å†…å®¹:', errorText);
                         throw new Error(`APIã‚¨ãƒ©ãƒ¼: ${response.status} ${response.statusText}`);
                    }
                    
                    const result = await response.json();
                    this.lastSyncTime = new Date();
                    this.updateSyncStatus('online', 'ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šæ¸ˆã¿');
                    return { success: true, id: result.id };
                } catch (error) {
                    console.error('åŒæœŸå¤±æ•—:', error);
                    this.syncQueue.push({ tableName, data, timestamp: new Date() });
                    return { success: false, error: error.message };
                }
            }

            async simulateDataSave(tableName, data) {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        if (Math.random() > 0.05) {
                            const id = Date.now() + Math.random();
                            console.log(`[${tableName}] Data saved:`, data);
                            resolve({ id, timestamp: new Date() });
                        } else {
                            reject(new Error('Database write failed'));
                        }
                    }, 500);
                });
            }

            async loadInitialData() {
                console.log('Loading initial data from database...');
            }

            async searchDatabase(query) {
                if (!this.isOnline) {
                    throw new Error('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ã™');
                }

                return new Promise((resolve) => {
                    setTimeout(() => {
                        const mockResults = [
                            {
                                process: 'æ¸©åº¦ç®¡ç†',
                                datetime: new Date().toLocaleString('ja-JP'),
                                details: `ãƒ­ãƒƒãƒˆ: ${query}`,
                                operator: 'ã‚·ã‚¹ãƒ†ãƒ æ¤œç´¢',
                                result: 'OK',
                                source: 'Database'
                            }
                        ];
                        resolve(mockResults);
                    }, 800);
                });
            }
        }

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
        const syncManager = new DatabaseSyncManager();

        // ãƒ‡ãƒ¼ã‚¿ä¿å­˜é…åˆ—
        let resinData = [];
        let temperatureData = [];
        let preformData = [];
        let moldingData = [];
        let coolingData = [];
        let inspectionData = [];

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
        function showTab(tabName) {
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            const clickedTab = Array.from(tabs).find(tab => tab.getAttribute('onclick').includes(tabName));
            if (clickedTab) {
                clickedTab.classList.add('active');
            }
        }

        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        function showAlert(elementId, type, message) {
            const alertDiv = document.getElementById(elementId);
            alertDiv.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => {
                alertDiv.innerHTML = '';
            }, 5000);
        }

        function showLoading(loadingId, show) {
            const loading = document.getElementById(loadingId);
            if (show) {
                loading.classList.add('show');
            } else {
                loading.classList.remove('show');
            }
        }

        function updateTable(tableId, data, columns) {
            const tbody = document.getElementById(tableId);
            tbody.innerHTML = '';
            
            data.slice(-10).reverse().forEach(item => {
                const row = tbody.insertRow();
                columns.forEach(column => {
                    const cell = row.insertCell();
                    if (column === 'syncStatus') {
                        cell.innerHTML = item[column] === 'synced' ? 
                            '<span class="status-ok">âœ“ å®Œäº†</span>' : 
                            '<span class="status-ng">â³ å¾…æ©Ÿä¸­</span>';
                    } else if (column === 'status' || column ===
                    'judgment') {
                        if (item[column] === 'OK' || item[column] === 'åˆæ ¼') {
                            cell.innerHTML = `<span class="status-ok">${item[column]}</span>`;
                        } else if (item[column] === 'NG' || item[column] === 'ä¸åˆæ ¼') {
                            cell.innerHTML = `<span class="status-ng">${item[column]}</span>`;
                        } else {
                            cell.textContent = item[column];
                        }
                    } else {
                        cell.textContent = item[column];
                    }
                });
            });
        }

        // æ¨¹è„‚ä¾›çµ¦ç›£è¦–æ©Ÿèƒ½
        async function recordResinCheck() {
            const btn = document.getElementById('resinCheckBtn');
            const loadingId = 'resinCheckLoading';
            
            const tankNumber = document.getElementById('tankNumber').value;
            const resinStatus = document.getElementById('resinStatus').value;
            const resinChecker = document.getElementById('resinChecker').value;

            if (!resinChecker) {
                showAlert('resinAlert', 'warning', 'ç¢ºèªè€…åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            btn.disabled = true;
            showLoading(loadingId, true);

            const record = {
                datetime: new Date().toLocaleString('ja-JP'),
                tankNumber,
                status: resinStatus,
                checker: resinChecker,
                
                amount: '-',
                syncStatus: 'syncing'
            };

            try {
                const syncResult = await syncManager.syncData('resin_check', record);
                record.syncStatus = syncResult.success ? 'synced' : 'queued';
                
                resinData.push(record);
                updateTable('resinTable', resinData, ['datetime', 'tankNumber', 'status','checker',
                'amount', 'supplier', 'notes', 'syncStatus']);
                
                showAlert('resinAlert', 'success', 'æ¨¹è„‚ãƒã‚§ãƒƒã‚¯ã‚’è¨˜éŒ²ã—ã¾ã—ãŸ');
                document.getElementById('resinChecker').value = '';
                
            } catch (error) {
                record.syncStatus = 'failed';
                showAlert('resinAlert', 'danger', 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
            } finally {
                btn.disabled = false;
                showLoading(loadingId, false);
            }
        }

      async function recordResinSupply() {
  const btn = document.getElementById('resinSupplyBtn');
  const loadingId = 'resinSupplyLoading';

  const tankNumber = document.getElementById('tankNumber')?.value || '';
  const resinAmountRaw = document.getElementById('resinAmount')?.value || '';
  const resinSupplier = document.getElementById('resinSupplier')?.value || '';
  const resinNotes = document.getElementById('resinNotes')?.value || '';

  const cleanedAmount = resinAmountRaw.replace(/[^\d.]/g, '');
  const amountValue = parseFloat(cleanedAmount);

  if (!resinSupplier || isNaN(amountValue)) {
    showAlert('resinAlert', 'warning', 'è£œå……è€…åã¨è£œå……é‡ï¼ˆæ•°å€¤ï¼‰ã‚’æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„');
    return;
  }

  const record = {
    datetime: new Date().toLocaleString('ja-JP'),
    tankNumber,
    status: 'OK',
    amount: amountValue,
    supplier: resinSupplier || null,
  notes: resinNotes || null,
    syncStatus: 'syncing'
  };

  console.log('âœ… resin-supply record:', record);

  btn.disabled = true;
  showLoading(loadingId, true);

  try {
    const syncResult = await syncManager.syncData('resin_supply', record);
    record.syncStatus = syncResult.success ? 'synced' : 'queued';

    resinData.push(record);
    updateTable('resinTable', resinData, [
      'datetime', 'tankNumber', 'status','checker',
       'amount', 'supplier', 'notes', 'syncStatus'
    ]);

    showAlert('resinAlert', 'success', 'æ¨¹è„‚è£œå……ã‚’è¨˜éŒ²ã—ã¾ã—ãŸ');

    document.getElementById('resinAmount').value = '';
    document.getElementById('resinSupplier').value = '';
    document.getElementById('resinNotes').value = '';
  } catch (error) {
    record.syncStatus = 'failed';
    showAlert('resinAlert', 'danger', 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
  } finally {
    btn.disabled = false;
    showLoading(loadingId, false);
  }
}




        

       

        // æ¸©åº¦ç®¡ç†æ©Ÿèƒ½
        async function recordTemperature() {
            const btn = document.getElementById('tempRecordBtn');
            const loadingId = 'tempRecordLoading';
            
            const lotNumber = document.getElementById('lotNumber').value;
            const setTemp = parseFloat(document.getElementById('setTemp').value);
            const actualTemp = parseFloat(document.getElementById('actualTemp').value);
            const tempChecker = document.getElementById('tempChecker').value;

            if (!lotNumber || !actualTemp || !tempChecker) {
                showAlert('tempAlert', 'warning', 'å…¨ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            btn.disabled = true;
            showLoading(loadingId, true);

            const difference = actualTemp - setTemp;
            const judgment = Math.abs(difference) <= 5 ? 'OK' : 'NG';

            const record = {
                datetime: new Date().toLocaleString('ja-JP'),
                lot: lotNumber,
                setTemp: setTemp + 'Â°C',
                actualTemp: actualTemp + 'Â°C',
                difference: (difference > 0 ? '+' : '') + difference.toFixed(1) + 'Â°C',
                judgment,
                checker: tempChecker,
                syncStatus: 'syncing'
            };

            try {
                const syncResult = await syncManager.syncData('temperature', record);
                record.syncStatus = syncResult.success ? 'synced' : 'queued';
                
                temperatureData.push(record);
                updateTable('tempTable', temperatureData, ['datetime', 'lot', 'setTemp', 'actualTemp', 'difference', 'judgment', 'checker', 'syncStatus']);
                
                if (judgment === 'NG') {
                    showAlert('tempAlert', 'warning', 'æ¸©åº¦ãŒåŸºæº–å€¤ã‚’è¶…ãˆã¦ã„ã¾ã™ï¼ç¢ºèªã—ã¦ãã ã•ã„');
                } else {
                    showAlert('tempAlert', 'success', 'æ¸©åº¦è¨˜éŒ²ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
                }
                
                document.getElementById('actualTemp').value = '';
                document.getElementById('tempChecker').value = '';
                
            } catch (error) {
                record.syncStatus = 'failed';
                showAlert('tempAlert', 'danger', 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
            } finally {
                btn.disabled = false;
                showLoading(loadingId, false);
            }
        }

        // ãƒ—ãƒªãƒ•ã‚©ãƒ¼ãƒ å“è³ªç¢ºèªæ©Ÿèƒ½
        async function recordPreformCheck() {
            const btn = document.getElementById('preformCheckBtn');
            const loadingId = 'preformCheckLoading';
            
            const sampleNumber = document.getElementById('sampleNumber').value;
            const preformWeight = parseFloat(document.getElementById('preformWeight').value);
            const shapeEval = document.getElementById('shapeEval').value;
            const preformInspector = document.getElementById('preformInspector').value;

            if (!sampleNumber || !preformWeight || !preformInspector) {
                showAlert('preformAlert', 'warning', 'å…¨ã¦ã®å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            btn.disabled = true;
            showLoading(loadingId, true);

            const standardWeight = 23.5;
            const tolerance = 0.5;
            const weightJudgment = Math.abs(preformWeight - standardWeight) <= tolerance ? 'OK' : 'NG';
            const overallJudgment = (weightJudgment === 'OK' && shapeEval === 'è‰¯å¥½') ? 'OK' : 'NG';

            let action = 'åˆæ ¼';
            if (overallJudgment === 'NG') {
                action = shapeEval === 'å»ƒæ£„' ? 'å»ƒæ£„' : 'å†æ¤œæŸ»';
            }

            const record = {
                datetime: new Date().toLocaleString('ja-JP'),
                sample: sampleNumber,
                weight: preformWeight + 'g',
                shape: shapeEval,
                judgment: overallJudgment,
                inspector: preformInspector,
                action,
                syncStatus: 'syncing'
            };

            try {
                const syncResult = await syncManager.syncData('preform_check', record);
                record.syncStatus = syncResult.success ? 'synced' : 'queued';
                
                preformData.push(record);
                updateTable('preformTable', preformData, ['datetime', 'sample', 'weight', 'shape', 'judgment', 'inspector', 'action', 'syncStatus']);
                
                if (overallJudgment === 'NG') {
                    showAlert('preformAlert', 'warning', 'ãƒ—ãƒªãƒ•ã‚©ãƒ¼ãƒ ãŒåŸºæº–å¤–ã§ã™ï¼' + action + 'ã—ã¦ãã ã•ã„');
                } else {
                    showAlert('preformAlert', 'success', 'ãƒ—ãƒªãƒ•ã‚©ãƒ¼ãƒ å“è³ªãƒã‚§ãƒƒã‚¯ã‚’è¨˜éŒ²ã—ã¾ã—ãŸ');
                }
                
                document.getElementById('sampleNumber').value = '';
                document.getElementById('preformWeight').value = '';
                document.getElementById('preformInspector').value = '';
                
            } catch (error) {
                record.syncStatus = 'failed';
                showAlert('preformAlert', 'danger', 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
            } finally {
                btn.disabled = false;
                showLoading(loadingId, false);
            }
        }

        // æˆå‹å·¥ç¨‹ãƒ¢ãƒ‹ã‚¿æ©Ÿèƒ½
        async function recordMoldingCheck() {
            const btn = document.getElementById('moldingCheckBtn');
            const loadingId = 'moldingCheckLoading';
            
            const productNumber = document.getElementById('productNumber').value;
            const thickness = parseFloat(document.getElementById('thickness').value);
            const bottleShape = document.getElementById('bottleShape').value;
            const moldingInspector = document.getElementById('moldingInspector').value;

            if (!productNumber || !thickness || !moldingInspector) {
                showAlert('moldingAlert', 'warning', 'å…¨ã¦ã®å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            btn.disabled = true;
            showLoading(loadingId, true);

            const standardThickness = 0.3;
            const tolerance = 0.05;
            const thicknessJudgment = Math.abs(thickness - standardThickness) <= tolerance ? 'OK' : 'NG';
            const overallJudgment = (thicknessJudgment === 'OK' && bottleShape === 'æ­£å¸¸') ? 'OK' : 'NG';

            let action = 'åˆæ ¼';
            if (overallJudgment === 'NG') {
                action = bottleShape === 'å»ƒæ£„' ? 'å»ƒæ£„' : 'è¦èª¿æ•´';
            }

            const record = {
                datetime: new Date().toLocaleString('ja-JP'),
                product: productNumber,
                thickness: thickness + 'mm',
                shape: bottleShape,
                judgment: overallJudgment,
                inspector: moldingInspector,
                action,
                syncStatus: 'syncing'
            };

            try {
                const syncResult = await syncManager.syncData('molding_check', record);
                record.syncStatus = syncResult.success ? 'synced' : 'queued';
                
                moldingData.push(record);
                updateTable('moldingTable', moldingData, ['datetime', 'product', 'thickness', 'shape', 'judgment', 'inspector', 'action', 'syncStatus']);
                
                if (overallJudgment === 'NG') {
                    showAlert('moldingAlert', 'warning', 'æˆå‹å“ãŒåŸºæº–å¤–ã§ã™ï¼' + action + 'ã—ã¦ãã ã•ã„');
                } else {
                    showAlert('moldingAlert', 'success', 'æˆå‹å“è³ªãƒã‚§ãƒƒã‚¯ã‚’è¨˜éŒ²ã—ã¾ã—ãŸ');
                }
                
                document.getElementById('productNumber').value = '';
                document.getElementById('thickness').value = '';
                document.getElementById('moldingInspector').value = '';
                
            } catch (error) {
                record.syncStatus = 'failed';
                showAlert('moldingAlert', 'danger', 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
            } finally {
                btn.disabled = false;
                showLoading(loadingId, false);
            }
        }

        // å†·å´æ™‚é–“ãƒ­ã‚°æ©Ÿèƒ½
        async function recordCooling() {
            const btn = document.getElementById('coolingBtn');
            const loadingId = 'coolingLoading';
            
            const coolingLot = document.getElementById('coolingLot').value;
            const coolingStart = document.getElementById('coolingStart').value;
            const coolingEnd = document.getElementById('coolingEnd').value;
            const coolingOperator = document.getElementById('coolingOperator').value;

            if (!coolingLot || !coolingStart || !coolingEnd || !coolingOperator) {
                showAlert('coolingAlert', 'warning', 'å…¨ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            btn.disabled = true;
            showLoading(loadingId, true);

            const startTime = new Date(coolingStart);
            const endTime = new Date(coolingEnd);
            const coolingTimeMs = endTime - startTime;
            const coolingTimeMinutes = Math.round(coolingTimeMs / (1000 * 60));

            const standardCoolingTime = 30; // 30åˆ†
            const judgment = coolingTimeMinutes >= standardCoolingTime ? 'OK' : 'NG';

            const record = {
                datetime: new Date().toLocaleString('ja-JP'),
                lot: coolingLot,
                startTime: startTime.toLocaleString('ja-JP'),
                endTime: endTime.toLocaleString('ja-JP'),
                coolingTime: coolingTimeMinutes + 'åˆ†',
                judgment,
                operator: coolingOperator,
                syncStatus: 'syncing'
            };

            try {
                const syncResult = await syncManager.syncData('cooling_log', record);
                record.syncStatus = syncResult.success ? 'synced' : 'queued';
                
                coolingData.push(record);
                updateTable('coolingTable', coolingData, ['datetime', 'lot', 'startTime', 'endTime', 'coolingTime', 'judgment', 'operator', 'syncStatus']);
                
                if (judgment === 'NG') {
                    showAlert('coolingAlert', 'warning', 'å†·å´æ™‚é–“ãŒä¸è¶³ã—ã¦ã„ã¾ã™ï¼ç¢ºèªã—ã¦ãã ã•ã„');
                } else {
                    showAlert('coolingAlert', 'success', 'å†·å´æ™‚é–“ãƒ­ã‚°ã‚’è¨˜éŒ²ã—ã¾ã—ãŸ');
                }
                
                document.getElementById('coolingLot').value = '';
                document.getElementById('coolingStart').value = '';
                document.getElementById('coolingEnd').value = '';
                document.getElementById('coolingOperator').value = '';
                
            } catch (error) {
                record.syncStatus = 'failed';
                showAlert('coolingAlert', 'danger', 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
            } finally {
                btn.disabled = false;
                showLoading(loadingId, false);
            }
        }

        // æ¤œæŸ»å·¥ç¨‹æ©Ÿèƒ½
        async function recordInspection() {
            const btn = document.getElementById('inspectionBtn');
            const loadingId = 'inspectionLoading';
            
            const inspectionId = document.getElementById('inspectionId').value;
            const visualCheck = document.getElementById('visualCheck').value;
            const dimensionCheck = document.getElementById('dimensionCheck').value;
            const pressureCheck = document.getElementById('pressureCheck').value;
            const finalInspector = document.getElementById('finalInspector').value;

            if (!inspectionId || !finalInspector) {
                showAlert('inspectionAlert', 'warning', 'æ¤œæŸ»IDã¨æ¤œæŸ»è€…åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            btn.disabled = true;
            showLoading(loadingId, true);

            const overallJudgment = (visualCheck === 'åˆæ ¼' && dimensionCheck === 'åˆæ ¼' && pressureCheck === 'åˆæ ¼') ? 'åˆæ ¼' : 'ä¸åˆæ ¼';
            const action = overallJudgment === 'åˆæ ¼' ? 'å‡ºè·å¯' : 'å†æ¤œæŸ»';

            const record = {
                datetime: new Date().toLocaleString('ja-JP'),
                inspectionId,
                visual: visualCheck,
                dimension: dimensionCheck,
                pressure: pressureCheck,
                judgment: overallJudgment,
                inspector: finalInspector,
                action
            };

            try {
                const syncResult = await syncManager.syncData('final_inspection', record);
                
                inspectionData.push(record);
                updateTable('inspectionTable', inspectionData, ['datetime', 'inspectionId', 'visual', 'dimension', 'pressure', 'judgment', 'inspector', 'action']);
                
                if (overallJudgment === 'ä¸åˆæ ¼') {
                    showAlert('inspectionAlert', 'warning', 'æ¤œæŸ»ä¸åˆæ ¼ã§ã™ï¼å†æ¤œæŸ»ã—ã¦ãã ã•ã„');
                } else {
                    showAlert('inspectionAlert', 'success', 'æ¤œæŸ»åˆæ ¼ï¼å‡ºè·å¯èƒ½ã§ã™');
                }
                
                document.getElementById('inspectionId').value = '';
                document.getElementById('finalInspector').value = '';
                
            } catch (error) {
                showAlert('inspectionAlert', 'danger', 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
            } finally {
                btn.disabled = false;
                showLoading(loadingId, false);
            }
        }

        // ãƒˆãƒ¬ãƒ¼ã‚µãƒ“ãƒªãƒ†ã‚£æ©Ÿèƒ½
        async function searchLot() {
            const btn = document.getElementById('searchBtn');
            const loadingId = 'searchLoading';
            
            const searchLot = document.getElementById('searchLot').value;

            if (!searchLot) {
                showAlert('traceabilityResult', 'warning', 'ãƒ­ãƒƒãƒˆç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            btn.disabled = true;
            showLoading(loadingId, true);

            try {
                const results = await syncManager.searchDatabase(searchLot);
                updateTable('traceabilityTable', results, ['process', 'datetime', 'details', 'operator', 'result', 'source']);
                showAlert('traceabilityResult', 'success', `${results.length}ä»¶ã®ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ`);
                
            } catch (error) {
                showAlert('traceabilityResult', 'danger', 'ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¤œç´¢ã‚¨ãƒ©ãƒ¼: ' + error.message);
            } finally {
                btn.disabled = false;
                showLoading(loadingId, false);
            }
        }

        // ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½
        function exportData() {
            const allData = {
                resin: resinData,
                temperature: temperatureData,
                preform: preformData,
                molding: moldingData,
                cooling: coolingData,
                inspection: inspectionData
            };

            const dataStr = JSON.stringify(allData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `pet_bottle_data_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);

            showAlert('traceabilityResult', 'success', 'ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ');
        }

        // åˆæœŸåŒ–å‡¦ç†
        document.addEventListener('DOMContentLoaded', function() {
            // ç¾åœ¨ã®æ—¥æ™‚ã‚’å†·å´æ™‚é–“ã®é–‹å§‹æ™‚é–“ã«è¨­å®š
            const now = new Date();
            const localDateTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
            document.getElementById('coolingStart').value = localDateTime;
            
            // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã®è¿½åŠ 
            setTimeout(() => {
                addSampleData();
            }, 2000);
        });

        // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿è¿½åŠ é–¢æ•°
        function addSampleData() {
            // ã‚µãƒ³ãƒ—ãƒ«æ¨¹è„‚ãƒ‡ãƒ¼ã‚¿
            resinData.push({
                datetime: new Date(Date.now() - 3600000).toLocaleString('ja-JP'),
                tankNumber: 'TANK-001',
                status: 'OK',
                checker: '-',
                amount: '-',
                notes: 'ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–',
                syncStatus: 'synced'
            });

            // ã‚µãƒ³ãƒ—ãƒ«æ¸©åº¦ãƒ‡ãƒ¼ã‚¿
            temperatureData.push({
                datetime: new Date(Date.now() - 1800000).toLocaleString('ja-JP'),
                lot: '250614-GT01',
                setTemp: '280.0Â°C',
                actualTemp: '281.2Â°C',
                difference: '+1.2Â°C',
                judgment: 'OK',
                checker: 'ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–',
                syncStatus: 'synced'
            });

            // ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ›´æ–°
            updateTable('resinTable', resinData, ['datetime', 'tankNumber', 'status', 'checker', 'amount', 'supplier', 'notes', 'syncStatus']);
            updateTable('tempTable', temperatureData, ['datetime', 'lot', 'setTemp', 'actualTemp', 'difference', 'judgment', 'checker', 'syncStatus']);
        }
    </script>
</body>
</html>